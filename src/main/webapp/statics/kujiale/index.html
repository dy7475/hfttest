<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<script src="../common/jquery-2.1.3.min.js" type="text/javascript"></script>
<style>
html,body{width: 100%;height: 100%;margin: 0;padding: 0;overflow: hidden;}
#kujialeIframe{width: 100%;height: 100%;border: 0;}
#userOption{position: absolute;top: 0px;left: 0px;width: 500px;height: 200px;background-color: #4d4d4d;}
</style>
<body>
	<div id="userOption">
		
	</div>
	<iframe id="kujialeIframe" src="http://www.kujiale.com/v/auth?accesstoken=OdOcvKJYNTyzOY0TBhLA5VWwhSKq17gG&dest=2&planid=3FO4IX3PLUAO"></iframe>
</body>
<script type="text/javascript">
	function setUrl(url) {
		$("#kujialeIframe").attr("src", url);
	}
	if (window.postMessage) {
		var callback = function(ev) {
			console ? console.log(ev) : alert(ev.data);
			if (ev.origin === 'http://www.kujiale.com' || ev.origin === 'http://yun.kujiale.com' ||
				ev.origin === 'https://www.kujiale.com' || ev.origin === 'https://yun.kujiale.com') {
				var data = JSON.parse(ev.data);
				$("#userOption").append(ev.data);
				if(data.action == "kjl_completed") {
					setUrl('http://www.kujiale.com');
				}
			}
		};
		if ('addEventListener' in document) {
			window.addEventListener('message', callback, false);
		} else if ('attachEvent' in document) {
			window.attachEvent('onmessage', callback);
		}
	} else {
		window.navigator.listenKJL = function(msg) {
			var data = JSON.parse(msg.data);
			$("#userOption").append(msg.data);
		};
	}
</script>
</html>
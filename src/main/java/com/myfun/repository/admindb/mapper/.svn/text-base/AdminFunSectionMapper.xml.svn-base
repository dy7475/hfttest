<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.myfun.repository.admindb.dao.AdminFunSectionMapper">
  <resultMap id="BaseResultMap" type="com.myfun.repository.admindb.po.AdminFunSection">
    <!--@mbggenerated-->
    <result column="SECTION_ID" jdbcType="INTEGER" property="sectionId" />
    <result column="CITY_ID" jdbcType="SMALLINT" property="cityId" />
    <result column="REG_ID" jdbcType="INTEGER" property="regId" />
    <result column="SECTION_CODE" jdbcType="VARCHAR" property="sectionCode" />
    <result column="SECTION_NAME" jdbcType="VARCHAR" property="sectionName" />
    <result column="VERTIFY_FLAG" jdbcType="TINYINT" property="vertifyFlag" />
    <result column="FId" jdbcType="INTEGER" property="fid" />
    <result column="ERP_SECTION_ID" jdbcType="INTEGER" property="erpSectionId" />
    <result column="UPDATE_TIME" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="SECTION_PINYIN" jdbcType="VARCHAR" property="sectionPinyin" />
    <result column="FDD_SECTION_ID" jdbcType="INTEGER" property="fddSectionId" />
  </resultMap>
  <insert id="insert" parameterType="com.myfun.repository.admindb.po.AdminFunSection">
    <!--@mbggenerated-->
    <selectKey keyProperty="sectionId" order="BEFORE" resultType="java.lang.Integer">
      SELECT (MAX(SECTION_ID) + 1) FROM FUN_SECTION
    </selectKey>
    insert into FUN_SECTION (SECTION_ID, CITY_ID, REG_ID, 
      SECTION_CODE, SECTION_NAME, VERTIFY_FLAG, 
      FId, ERP_SECTION_ID, UPDATE_TIME, 
      SECTION_PINYIN, FDD_SECTION_ID)
    values (#{sectionId,jdbcType=INTEGER}, #{cityId,jdbcType=SMALLINT}, #{regId,jdbcType=INTEGER}, 
      #{sectionCode,jdbcType=VARCHAR}, #{sectionName,jdbcType=VARCHAR}, #{vertifyFlag,jdbcType=TINYINT}, 
      #{fid,jdbcType=INTEGER}, #{erpSectionId,jdbcType=INTEGER}, #{updateTime,jdbcType=TIMESTAMP}, 
      #{sectionPinyin,jdbcType=VARCHAR}, #{fddSectionId,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.myfun.repository.admindb.po.AdminFunSection">
    <!--@mbggenerated-->
    <selectKey keyProperty="sectionId" order="BEFORE" resultType="java.lang.Integer">
      SELECT (MAX(SECTION_ID) + 1) FROM FUN_SECTION
    </selectKey>
    insert into FUN_SECTION
    <trim prefix="(" suffix=")" suffixOverrides=",">
      SECTION_ID,
      <if test="cityId != null">
        CITY_ID,
      </if>
      <if test="regId != null">
        REG_ID,
      </if>
      <if test="sectionCode != null">
        SECTION_CODE,
      </if>
      <if test="sectionName != null">
        SECTION_NAME,
      </if>
      <if test="vertifyFlag != null">
        VERTIFY_FLAG,
      </if>
      <if test="fid != null">
        FId,
      </if>
      <if test="erpSectionId != null">
        ERP_SECTION_ID,
      </if>
      <if test="updateTime != null">
        UPDATE_TIME,
      </if>
      <if test="sectionPinyin != null">
        SECTION_PINYIN,
      </if>
      <if test="fddSectionId != null">
        FDD_SECTION_ID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      #{sectionId,jdbcType=INTEGER},
      <if test="cityId != null">
        #{cityId,jdbcType=SMALLINT},
      </if>
      <if test="regId != null">
        #{regId,jdbcType=INTEGER},
      </if>
      <if test="sectionCode != null">
        #{sectionCode,jdbcType=VARCHAR},
      </if>
      <if test="sectionName != null">
        #{sectionName,jdbcType=VARCHAR},
      </if>
      <if test="vertifyFlag != null">
        #{vertifyFlag,jdbcType=TINYINT},
      </if>
      <if test="fid != null">
        #{fid,jdbcType=INTEGER},
      </if>
      <if test="erpSectionId != null">
        #{erpSectionId,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sectionPinyin != null">
        #{sectionPinyin,jdbcType=VARCHAR},
      </if>
      <if test="fddSectionId != null">
        #{fddSectionId,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  
  <resultMap extends="BaseResultMap" id="BaseResultMapDto" type="com.myfun.repository.admindb.dto.AdminFunSectionDto">
  	<result column="PROVINCE_NAME" jdbcType="VARCHAR" property="provinceName" />
    <result column="city_Name" jdbcType="VARCHAR" property="cityName" />
  </resultMap>
  
  <resultMap id="selectMap" type="com.myfun.repository.agencydb.dto.SelectDto">
  	 <result column="SECTION_ID" jdbcType="VARCHAR" property="text" />
    <result column="SECTION_NAME" jdbcType="VARCHAR" property="value" />
  </resultMap>
  
  <!-- business -->
  <select id="getSectionInfo" resultMap="selectMap">
  	select SECTION_ID, SECTION_NAME from FUN_SECTION where city_Id = #{cityId} and reg_id = #{regId}
  </select>
  
  <select id="getSectionsData" parameterType="com.myfun.repository.admindb.dto.AdminFunSectionDto" resultMap="BaseResultMapDto">
  	 select 
   	fs.SECTION_ID, fs.CITY_ID, fs.REG_ID, fs.SECTION_CODE, fs.SECTION_NAME, fs.VERTIFY_FLAG, fs.FId
   	, fc.city_Name,fp.PROVINCE_NAME
    from FUN_SECTION fs
    LEFT JOIN fun_city fc ON fs.city_id = fc.city_id
	LEFT JOIN FUN_PROVINCE fp ON fc.PROVINCE_id = fp.PROVINCE_id
    where 
      fs.CITY_ID = #{cityId}
      <if test="regId != null and regId != ''">
      	and fs.REG_ID = #{regId}
      </if>
      <if test="sectionCode != null and sectionCode != ''">
      	and fs.SECTION_CODE like '${sectionCode}%'
      </if>
      <if test="sectionName != null and sectionName != ''">
      	and fs.SECTION_NAME like '%${sectionName}%'
      </if>
      <if test="auditStatus != null and auditStatus != ''">
      	and fs.VERTIFY_FLAG = #{auditStatus}
      </if>
      order by SECTION_CODE ASC, VERTIFY_FLAG DESC
  </select>
  
  <select id="getId" resultType="java.lang.Integer">
  	SELECT max(SECTION_ID) from FUN_SECTION
  </select>
  <select id="selectSectionByRegIdAndSectionName" resultMap="selectMap">
  	select SECTION_ID as SECTION_ID ,SECTION_NAME as SECTION_NAME from FUN_SECTION
  	<where>
  		<if test="null != regId">
  			AND REG_ID = #{regId}
  		</if>
  		<if test="null != sectionName and '' != sectionName">
  			and SECTION_NAME like '%${sectionName}%'
  		</if>
  	</where>
  </select>

  <select id="getModelDataList" resultType="java.util.Map">
    SELECT
    REG_ID,SECTION_ID
    FROM FUN_SECTION
    WHERE VERTIFY_FLAG = '1' AND REG_ID in
    <foreach close=")" collection="regIds" index="index" item="regId" open="(" separator=",">
      #{regId}
    </foreach>
    AND CITY_ID = #{cityId}
  </select>
  <select id="selectListBySectionIds" resultMap="BaseResultMap">
    SELECT
    REG_ID,SECTION_ID,SECTION_NAME
    FROM FUN_SECTION
    WHERE VERTIFY_FLAG = '1' AND SECTION_ID in
    <foreach close=")" collection="sectionIds" index="index" item="sectionId" open="(" separator=",">
      #{sectionId}
    </foreach>
    AND CITY_ID = #{cityId}
  </select>
</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.myfun.repository.erpdb.dao.ErpYouBorkerComplaintMapper">
  <resultMap id="BaseResultMap" type="com.myfun.repository.erpdb.po.ErpYouBorkerComplaint">
    <!--@mbggenerated-->
    <id column="COMPLAINT_ID" jdbcType="INTEGER" property="complaintId" />
    <result column="SOURCE_INFO_ID" jdbcType="INTEGER" property="sourceInfoId" />
    <result column="TARGET_INFO_ID" jdbcType="INTEGER" property="targetInfoId" />
    <result column="CINFO_TYPE" jdbcType="TINYINT" property="cinfoType" />
    <result column="CASE_ID" jdbcType="INTEGER" property="caseId" />
    <result column="CASE_TYPE" jdbcType="TINYINT" property="caseType" />
    <result column="SOURCE_COMP_ID" jdbcType="INTEGER" property="sourceCompId" />
    <result column="SOURCE_DEPT_ID" jdbcType="INTEGER" property="sourceDeptId" />
    <result column="SOURCE_USER_ID" jdbcType="INTEGER" property="sourceUserId" />
    <result column="SOURCE_ARCHIVE_ID" jdbcType="INTEGER" property="sourceArchiveId" />
    <result column="TARGET_COMP_ID" jdbcType="INTEGER" property="targetCompId" />
    <result column="TARGET_DEPT_ID" jdbcType="INTEGER" property="targetDeptId" />
    <result column="TARGET_USER_ID" jdbcType="INTEGER" property="targetUserId" />
    <result column="TARGET_ARCHIVE_ID" jdbcType="INTEGER" property="targetArchiveId" />
    <result column="COMPLAIN_CONTENT" jdbcType="VARCHAR" property="complainContent" />
    <result column="COMPLAIN_TYPE" jdbcType="TINYINT" property="complainType" />
    <result column="DEAL_STATUS" jdbcType="TINYINT" property="dealStatus" />
    <result column="DEAL_TYPE" jdbcType="TINYINT" property="dealType" />
    <result column="DEAL_DESC" jdbcType="VARCHAR" property="dealDesc" />
    <result column="DEAL_TIME" jdbcType="TIMESTAMP" property="dealTime" />
    <result column="DEAL_CRM_USER" jdbcType="INTEGER" property="dealCrmUser" />
    <result column="COMPLAIN_TIME" jdbcType="TIMESTAMP" property="complainTime" />
    <result column="CITY_ID" jdbcType="INTEGER" property="cityId" />
  </resultMap>
  <resultMap type="com.myfun.repository.erpdb.dto.ErpYouBorkerComplaintDto" id="exResultMap" extends="BaseResultMap">
  	<result column="SOURCE_USER_NAME" property="sourceUserName" jdbcType="VARCHAR" />
  	<result column="SOURCE_USER_MOBILE" property="sourceUserMobile" jdbcType="VARCHAR" />
  	<result column="TARGET_USER_NAME" property="targetUserName" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--@mbggenerated-->
    COMPLAINT_ID, SOURCE_INFO_ID, TARGET_INFO_ID, CINFO_TYPE, CASE_ID, CASE_TYPE, SOURCE_COMP_ID, 
    SOURCE_DEPT_ID, SOURCE_USER_ID, SOURCE_ARCHIVE_ID, TARGET_COMP_ID, TARGET_DEPT_ID, 
    TARGET_USER_ID, TARGET_ARCHIVE_ID, COMPLAIN_CONTENT, COMPLAIN_TYPE, DEAL_STATUS, 
    DEAL_TYPE, DEAL_DESC, DEAL_TIME, DEAL_CRM_USER, COMPLAIN_TIME, CITY_ID
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--@mbggenerated-->
    select 
    <include refid="Base_Column_List" />
    from YOU_BORKER_COMPLAINT
    where COMPLAINT_ID = #{complaintId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--@mbggenerated-->
    delete from YOU_BORKER_COMPLAINT
    where COMPLAINT_ID = #{complaintId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.myfun.repository.erpdb.po.ErpYouBorkerComplaint">
    <!--@mbggenerated-->
    <selectKey keyProperty="complaintId" order="BEFORE" resultType="java.lang.Integer">
      SELECT MAX(ISNULL(YOU_BORKER_COMPLAINT,0))+1 FROM YOU_BORKER_COMPLAINT
    </selectKey>
    insert into YOU_BORKER_COMPLAINT (COMPLAINT_ID, SOURCE_INFO_ID, TARGET_INFO_ID, 
      CINFO_TYPE, CASE_ID, CASE_TYPE, 
      SOURCE_COMP_ID, SOURCE_DEPT_ID, SOURCE_USER_ID, 
      SOURCE_ARCHIVE_ID, TARGET_COMP_ID, TARGET_DEPT_ID, 
      TARGET_USER_ID, TARGET_ARCHIVE_ID, COMPLAIN_CONTENT, 
      COMPLAIN_TYPE, DEAL_STATUS, DEAL_TYPE, 
      DEAL_DESC, DEAL_TIME, DEAL_CRM_USER, 
      COMPLAIN_TIME, CITY_ID)
    values (#{complaintId,jdbcType=INTEGER}, #{sourceInfoId,jdbcType=INTEGER}, #{targetInfoId,jdbcType=INTEGER}, 
      #{cinfoType,jdbcType=TINYINT}, #{caseId,jdbcType=INTEGER}, #{caseType,jdbcType=TINYINT}, 
      #{sourceCompId,jdbcType=INTEGER}, #{sourceDeptId,jdbcType=INTEGER}, #{sourceUserId,jdbcType=INTEGER}, 
      #{sourceArchiveId,jdbcType=INTEGER}, #{targetCompId,jdbcType=INTEGER}, #{targetDeptId,jdbcType=INTEGER}, 
      #{targetUserId,jdbcType=INTEGER}, #{targetArchiveId,jdbcType=INTEGER}, #{complainContent,jdbcType=VARCHAR}, 
      #{complainType,jdbcType=TINYINT}, #{dealStatus,jdbcType=TINYINT}, #{dealType,jdbcType=TINYINT}, 
      #{dealDesc,jdbcType=VARCHAR}, #{dealTime,jdbcType=TIMESTAMP}, #{dealCrmUser,jdbcType=INTEGER}, 
      #{complainTime,jdbcType=TIMESTAMP}, #{cityId,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.myfun.repository.erpdb.po.ErpYouBorkerComplaint">
    <!--@mbggenerated-->
    <selectKey keyProperty="complaintId" order="BEFORE" resultType="java.lang.Integer">
      SELECT MAX(ISNULL(YOU_BORKER_COMPLAINT,0))+1 FROM YOU_BORKER_COMPLAINT
    </selectKey>
    insert into YOU_BORKER_COMPLAINT
    <trim prefix="(" suffix=")" suffixOverrides=",">
      COMPLAINT_ID,
      <if test="sourceInfoId != null">
        SOURCE_INFO_ID,
      </if>
      <if test="targetInfoId != null">
        TARGET_INFO_ID,
      </if>
      <if test="cinfoType != null">
        CINFO_TYPE,
      </if>
      <if test="caseId != null">
        CASE_ID,
      </if>
      <if test="caseType != null">
        CASE_TYPE,
      </if>
      <if test="sourceCompId != null">
        SOURCE_COMP_ID,
      </if>
      <if test="sourceDeptId != null">
        SOURCE_DEPT_ID,
      </if>
      <if test="sourceUserId != null">
        SOURCE_USER_ID,
      </if>
      <if test="sourceArchiveId != null">
        SOURCE_ARCHIVE_ID,
      </if>
      <if test="targetCompId != null">
        TARGET_COMP_ID,
      </if>
      <if test="targetDeptId != null">
        TARGET_DEPT_ID,
      </if>
      <if test="targetUserId != null">
        TARGET_USER_ID,
      </if>
      <if test="targetArchiveId != null">
        TARGET_ARCHIVE_ID,
      </if>
      <if test="complainContent != null">
        COMPLAIN_CONTENT,
      </if>
      <if test="complainType != null">
        COMPLAIN_TYPE,
      </if>
      <if test="dealStatus != null">
        DEAL_STATUS,
      </if>
      <if test="dealType != null">
        DEAL_TYPE,
      </if>
      <if test="dealDesc != null">
        DEAL_DESC,
      </if>
      <if test="dealTime != null">
        DEAL_TIME,
      </if>
      <if test="dealCrmUser != null">
        DEAL_CRM_USER,
      </if>
      <if test="complainTime != null">
        COMPLAIN_TIME,
      </if>
      <if test="cityId != null">
        CITY_ID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      #{complaintId,jdbcType=INTEGER},
      <if test="sourceInfoId != null">
        #{sourceInfoId,jdbcType=INTEGER},
      </if>
      <if test="targetInfoId != null">
        #{targetInfoId,jdbcType=INTEGER},
      </if>
      <if test="cinfoType != null">
        #{cinfoType,jdbcType=TINYINT},
      </if>
      <if test="caseId != null">
        #{caseId,jdbcType=INTEGER},
      </if>
      <if test="caseType != null">
        #{caseType,jdbcType=TINYINT},
      </if>
      <if test="sourceCompId != null">
        #{sourceCompId,jdbcType=INTEGER},
      </if>
      <if test="sourceDeptId != null">
        #{sourceDeptId,jdbcType=INTEGER},
      </if>
      <if test="sourceUserId != null">
        #{sourceUserId,jdbcType=INTEGER},
      </if>
      <if test="sourceArchiveId != null">
        #{sourceArchiveId,jdbcType=INTEGER},
      </if>
      <if test="targetCompId != null">
        #{targetCompId,jdbcType=INTEGER},
      </if>
      <if test="targetDeptId != null">
        #{targetDeptId,jdbcType=INTEGER},
      </if>
      <if test="targetUserId != null">
        #{targetUserId,jdbcType=INTEGER},
      </if>
      <if test="targetArchiveId != null">
        #{targetArchiveId,jdbcType=INTEGER},
      </if>
      <if test="complainContent != null">
        #{complainContent,jdbcType=VARCHAR},
      </if>
      <if test="complainType != null">
        #{complainType,jdbcType=TINYINT},
      </if>
      <if test="dealStatus != null">
        #{dealStatus,jdbcType=TINYINT},
      </if>
      <if test="dealType != null">
        #{dealType,jdbcType=TINYINT},
      </if>
      <if test="dealDesc != null">
        #{dealDesc,jdbcType=VARCHAR},
      </if>
      <if test="dealTime != null">
        #{dealTime,jdbcType=TIMESTAMP},
      </if>
      <if test="dealCrmUser != null">
        #{dealCrmUser,jdbcType=INTEGER},
      </if>
      <if test="complainTime != null">
        #{complainTime,jdbcType=TIMESTAMP},
      </if>
      <if test="cityId != null">
        #{cityId,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.myfun.repository.erpdb.po.ErpYouBorkerComplaint">
    <!--@mbggenerated-->
    update YOU_BORKER_COMPLAINT
    <set>
      <if test="sourceInfoId != null">
        SOURCE_INFO_ID = #{sourceInfoId,jdbcType=INTEGER},
      </if>
      <if test="targetInfoId != null">
        TARGET_INFO_ID = #{targetInfoId,jdbcType=INTEGER},
      </if>
      <if test="cinfoType != null">
        CINFO_TYPE = #{cinfoType,jdbcType=TINYINT},
      </if>
      <if test="caseId != null">
        CASE_ID = #{caseId,jdbcType=INTEGER},
      </if>
      <if test="caseType != null">
        CASE_TYPE = #{caseType,jdbcType=TINYINT},
      </if>
      <if test="sourceCompId != null">
        SOURCE_COMP_ID = #{sourceCompId,jdbcType=INTEGER},
      </if>
      <if test="sourceDeptId != null">
        SOURCE_DEPT_ID = #{sourceDeptId,jdbcType=INTEGER},
      </if>
      <if test="sourceUserId != null">
        SOURCE_USER_ID = #{sourceUserId,jdbcType=INTEGER},
      </if>
      <if test="sourceArchiveId != null">
        SOURCE_ARCHIVE_ID = #{sourceArchiveId,jdbcType=INTEGER},
      </if>
      <if test="targetCompId != null">
        TARGET_COMP_ID = #{targetCompId,jdbcType=INTEGER},
      </if>
      <if test="targetDeptId != null">
        TARGET_DEPT_ID = #{targetDeptId,jdbcType=INTEGER},
      </if>
      <if test="targetUserId != null">
        TARGET_USER_ID = #{targetUserId,jdbcType=INTEGER},
      </if>
      <if test="targetArchiveId != null">
        TARGET_ARCHIVE_ID = #{targetArchiveId,jdbcType=INTEGER},
      </if>
      <if test="complainContent != null">
        COMPLAIN_CONTENT = #{complainContent,jdbcType=VARCHAR},
      </if>
      <if test="complainType != null">
        COMPLAIN_TYPE = #{complainType,jdbcType=TINYINT},
      </if>
      <if test="dealStatus != null">
        DEAL_STATUS = #{dealStatus,jdbcType=TINYINT},
      </if>
      <if test="dealType != null">
        DEAL_TYPE = #{dealType,jdbcType=TINYINT},
      </if>
      <if test="dealDesc != null">
        DEAL_DESC = #{dealDesc,jdbcType=VARCHAR},
      </if>
      <if test="dealTime != null">
        DEAL_TIME = #{dealTime,jdbcType=TIMESTAMP},
      </if>
      <if test="dealCrmUser != null">
        DEAL_CRM_USER = #{dealCrmUser,jdbcType=INTEGER},
      </if>
      <if test="complainTime != null">
        COMPLAIN_TIME = #{complainTime,jdbcType=TIMESTAMP},
      </if>
      <if test="cityId != null">
        CITY_ID = #{cityId,jdbcType=INTEGER},
      </if>
    </set>
    where COMPLAINT_ID = #{complaintId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.myfun.repository.erpdb.po.ErpYouBorkerComplaint">
    <!--@mbggenerated-->
    update YOU_BORKER_COMPLAINT
    set SOURCE_INFO_ID = #{sourceInfoId,jdbcType=INTEGER},
      TARGET_INFO_ID = #{targetInfoId,jdbcType=INTEGER},
      CINFO_TYPE = #{cinfoType,jdbcType=TINYINT},
      CASE_ID = #{caseId,jdbcType=INTEGER},
      CASE_TYPE = #{caseType,jdbcType=TINYINT},
      SOURCE_COMP_ID = #{sourceCompId,jdbcType=INTEGER},
      SOURCE_DEPT_ID = #{sourceDeptId,jdbcType=INTEGER},
      SOURCE_USER_ID = #{sourceUserId,jdbcType=INTEGER},
      SOURCE_ARCHIVE_ID = #{sourceArchiveId,jdbcType=INTEGER},
      TARGET_COMP_ID = #{targetCompId,jdbcType=INTEGER},
      TARGET_DEPT_ID = #{targetDeptId,jdbcType=INTEGER},
      TARGET_USER_ID = #{targetUserId,jdbcType=INTEGER},
      TARGET_ARCHIVE_ID = #{targetArchiveId,jdbcType=INTEGER},
      COMPLAIN_CONTENT = #{complainContent,jdbcType=VARCHAR},
      COMPLAIN_TYPE = #{complainType,jdbcType=TINYINT},
      DEAL_STATUS = #{dealStatus,jdbcType=TINYINT},
      DEAL_TYPE = #{dealType,jdbcType=TINYINT},
      DEAL_DESC = #{dealDesc,jdbcType=VARCHAR},
      DEAL_TIME = #{dealTime,jdbcType=TIMESTAMP},
      DEAL_CRM_USER = #{dealCrmUser,jdbcType=INTEGER},
      COMPLAIN_TIME = #{complainTime,jdbcType=TIMESTAMP},
      CITY_ID = #{cityId,jdbcType=INTEGER}
    where COMPLAINT_ID = #{complaintId,jdbcType=INTEGER}
  </update>
  
  <select id="getNotComPlainCounts" parameterType="java.lang.Integer" resultType="java.lang.Integer">
  	SELECT COUNT(*) from YOU_BORKER_COMPLAINT WITH(NOLOCK) 
  	WHERE DEAL_STATUS=0 and (SOURCE_INFO_ID=#{shareId,jdbcType=INTEGER} OR TARGET_INFO_ID=#{shareId,jdbcType=INTEGER})
  </select>
  <select id="getHouseComPlainCounts" parameterType="java.lang.Integer" resultType="java.lang.Integer">
  	SELECT COUNT(1) AS NUMBERS from YOU_BORKER_COMPLAINT WITH(NOLOCK) 
  	WHERE SOURCE_INFO_ID=#{shareId,jdbcType=INTEGER} OR TARGET_INFO_ID=#{shareId,jdbcType=INTEGER}
  </select>
  <select id="getPurchasePersonNumber" parameterType="java.lang.Integer" resultType="java.lang.Integer">
  	SELECT COUNT(1) AS NUMBERS from YOU_BORKER_PURCHASE WITH(NOLOCK) WHERE YOU_SHARE_ID=#{shareId,jdbcType=INTEGER}
  </select>
  <select id="getCompalinListByShareId" parameterType="com.myfun.repository.erpdb.po.ErpYouShareHouseStatus" resultMap="exResultMap">
  	select FU.USER_NAME AS SOURCE_USER_NAME, FU.USER_MOBILE AS SOURCE_USER_MOBILE, FUS.USER_NAME AS TARGET_USER_NAME,
           YBC.COMPLAINT_ID, YBC.SOURCE_INFO_ID, YBC.TARGET_INFO_ID, YBC.CINFO_TYPE, YBC.CASE_ID, YBC.CASE_TYPE, YBC.SOURCE_COMP_ID,
           YBC.SOURCE_DEPT_ID, YBC.SOURCE_USER_ID, YBC.SOURCE_ARCHIVE_ID, YBC.TARGET_COMP_ID, YBC.TARGET_DEPT_ID,
           YBC.TARGET_USER_ID, YBC.TARGET_ARCHIVE_ID, YBC.COMPLAIN_CONTENT, YBC.COMPLAIN_TYPE, YBC.DEAL_STATUS,
           YBC.DEAL_TYPE, YBC.DEAL_DESC, YBC.DEAL_TIME, YBC.DEAL_CRM_USER, YBC.COMPLAIN_TIME, YBC.CITY_ID
	from YOU_BORKER_COMPLAINT YBC 
	LEFT JOIN FUN_USERS FU ON YBC.SOURCE_USER_ID=FU.USER_ID 
	LEFT JOIN FUN_USERS FUS ON YBC.TARGET_USER_ID=FUS.USER_ID 
	where (YBC.SOURCE_INFO_ID=#{param.shareId,jdbcType=INTEGER} OR YBC.TARGET_INFO_ID=#{param.shareId,jdbcType=INTEGER}) 
	AND YBC.CITY_ID= #{param.cityId,jdbcType=INTEGER}
	ORDER BY DEAL_STATUS ASC
  </select>
  <select id="getByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from YOU_BORKER_COMPLAINT
    where COMPLAINT_ID = #{complainId,jdbcType=INTEGER}
  </select>
  
  <update id="updateComplaint" parameterType="com.myfun.repository.erpdb.po.ErpYouBorkerComplaint">
 	UPDATE YOU_BORKER_COMPLAINT 
  	SET DEAL_STATUS=2, 
  	<if test="complaint.dealTime !=null">
	  	DEAL_TIME=#{complaint.dealTime,jdbcType=TIMESTAMP},
  	</if>
  	<if test="complaint.dealType !=null">
  		DEAL_TYPE=#{complaint.dealType,jdbcType=TINYINT}, 
  	</if>
  	<if test="complaint.dealDesc!=null and complaint.dealDesc!= ''">
  		DEAL_DESC=#{complaint.dealDesc,jdbcType=VARCHAR}, 
  	</if>
  	<if test="complaint.dealCrmUser !=null">
  		DEAL_CRM_USER=#{complaint.dealCrmUser,jdbcType=INTEGER} 
  	</if>
  	WHERE DEAL_STATUS=0 
  	<if test="complaint.targetInfoId !=null">
  		AND TARGET_INFO_ID=#{complaint.targetInfoId,jdbcType=INTEGER} 
  	</if>
  	<if test="complaint.cinfoType !=null">
  		AND CINFO_TYPE=#{complaint.cinfoType,jdbcType=TINYINT} 
  	</if>
  	<if test="complaint.complaintId !=null">
  		AND COMPLAINT_ID!=#{complaint.complaintId,jdbcType=INTEGER} 
  	</if>
  	<if test="complaint.targetArchiveId !=null">
  		AND TARGET_ARCHIVE_ID=#{complaint.targetArchiveId,jdbcType=INTEGER}
  	</if>
  </update>
</mapper>
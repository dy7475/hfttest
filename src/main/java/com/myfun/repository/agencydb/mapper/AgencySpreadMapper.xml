<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.myfun.repository.agencydb.dao.AgencySpreadMapper">
  <resultMap id="BaseResultMap" type="com.myfun.repository.agencydb.po.AgencySpread">
    <!--@mbggenerated-->
    <id column="SPREAD_ID" jdbcType="INTEGER" property="spreadId" />
    <result column="CITY_ID" jdbcType="INTEGER" property="cityId" />
    <result column="DEVLOPER_ID" jdbcType="INTEGER" property="devloperId" />
    <result column="BUILD_ID" jdbcType="INTEGER" property="buildId" />
    <result column="REG_NAME" jdbcType="VARCHAR" property="regName" />
    <result column="DEPT_NUM" jdbcType="INTEGER" property="deptNum" />
    <result column="AGENT_NUM" jdbcType="INTEGER" property="agentNum" />
    <result column="DS_CONNECTION_ID" jdbcType="VARCHAR" property="dsConnectionId" />
    <result column="SPREAD_TITLE" jdbcType="VARCHAR" property="spreadTitle" />
    <result column="SPREAD_CONTENT" jdbcType="VARCHAR" property="spreadContent" />
    <result column="CREATION_TIME" jdbcType="TIMESTAMP" property="creationTime" />
    <result column="CREATE_UID" jdbcType="INTEGER" property="createUid" />
    <result column="CHECK_TIME" jdbcType="TIMESTAMP" property="checkTime" />
    <result column="CHECK_UID" jdbcType="INTEGER" property="checkUid" />
    <result column="CHECK_UNAME" jdbcType="VARCHAR" property="checkUname" />
    <result column="CHECK_STATUS" jdbcType="INTEGER" property="checkStatus" />
    <result column="IS_DELETE" jdbcType="INTEGER" property="isDelete" />
    <result column="SEND_ERP" jdbcType="TINYINT" property="sendErp" />
    <result column="SEND_APP" jdbcType="TINYINT" property="sendApp" />
    <result column="SEND_CITY_ID" jdbcType="INTEGER" property="sendCityId" />
  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.myfun.repository.agencydb.po.AgencySpread">
    <!--@mbggenerated-->
    <result column="DEPT_IDS" jdbcType="CLOB" property="deptIds" />
    <result column="DEPT_NAMES" jdbcType="CLOB" property="deptNames" />
  </resultMap>
  <resultMap extends="ResultMapWithBLOBs" id="extResultMap" type="com.myfun.repository.agencydb.dto.AgencyAmountHistoryDto">
  	<result column="SPREAD_CONTENT" jdbcType="CLOB" property="spreadContent" />
  	<result column="SPREAD_TITLE" jdbcType="CLOB" property="spreadTitle" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--@mbggenerated-->
    SPREAD_ID, CITY_ID, DEVLOPER_ID, BUILD_ID, REG_NAME, DEPT_NUM, AGENT_NUM, DS_CONNECTION_ID, 
    SPREAD_TITLE, SPREAD_CONTENT, CREATION_TIME, CREATE_UID, CHECK_TIME, CHECK_UID, CHECK_UNAME, 
    CHECK_STATUS, IS_DELETE, SEND_ERP, SEND_APP, SEND_CITY_ID
  </sql>
  <sql id="Blob_Column_List">
    <!--@mbggenerated-->
    DEPT_IDS, DEPT_NAMES
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="ResultMapWithBLOBs">
    <!--@mbggenerated-->
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from SPREAD
    where SPREAD_ID = #{spreadId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--@mbggenerated-->
    delete from SPREAD
    where SPREAD_ID = #{spreadId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.myfun.repository.agencydb.po.AgencySpread">
    <!--@mbggenerated-->
    insert into SPREAD (SPREAD_ID, CITY_ID, DEVLOPER_ID, 
      BUILD_ID, REG_NAME, DEPT_NUM, 
      AGENT_NUM, DS_CONNECTION_ID, SPREAD_TITLE, 
      SPREAD_CONTENT, CREATION_TIME, CREATE_UID, 
      CHECK_TIME, CHECK_UID, CHECK_UNAME, 
      CHECK_STATUS, IS_DELETE, SEND_ERP, 
      SEND_APP, SEND_CITY_ID, DEPT_IDS, 
      DEPT_NAMES)
    values (#{spreadId,jdbcType=INTEGER}, #{cityId,jdbcType=INTEGER}, #{devloperId,jdbcType=INTEGER}, 
      #{buildId,jdbcType=INTEGER}, #{regName,jdbcType=VARCHAR}, #{deptNum,jdbcType=INTEGER}, 
      #{agentNum,jdbcType=INTEGER}, #{dsConnectionId,jdbcType=VARCHAR}, #{spreadTitle,jdbcType=VARCHAR}, 
      #{spreadContent,jdbcType=VARCHAR}, #{creationTime,jdbcType=TIMESTAMP}, #{createUid,jdbcType=INTEGER}, 
      #{checkTime,jdbcType=TIMESTAMP}, #{checkUid,jdbcType=INTEGER}, #{checkUname,jdbcType=VARCHAR}, 
      #{checkStatus,jdbcType=INTEGER}, #{isDelete,jdbcType=INTEGER}, #{sendErp,jdbcType=TINYINT}, 
      #{sendApp,jdbcType=TINYINT}, #{sendCityId,jdbcType=INTEGER}, #{deptIds,jdbcType=CLOB}, 
      #{deptNames,jdbcType=CLOB})
  </insert>
  <insert id="insertSelective" parameterType="com.myfun.repository.agencydb.po.AgencySpread">
    <!--@mbggenerated-->
    insert into SPREAD
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="spreadId != null">
        SPREAD_ID,
      </if>
      <if test="cityId != null">
        CITY_ID,
      </if>
      <if test="devloperId != null">
        DEVLOPER_ID,
      </if>
      <if test="buildId != null">
        BUILD_ID,
      </if>
      <if test="regName != null">
        REG_NAME,
      </if>
      <if test="deptNum != null">
        DEPT_NUM,
      </if>
      <if test="agentNum != null">
        AGENT_NUM,
      </if>
      <if test="dsConnectionId != null">
        DS_CONNECTION_ID,
      </if>
      <if test="spreadTitle != null">
        SPREAD_TITLE,
      </if>
      <if test="spreadContent != null">
        SPREAD_CONTENT,
      </if>
      <if test="creationTime != null">
        CREATION_TIME,
      </if>
      <if test="createUid != null">
        CREATE_UID,
      </if>
      <if test="checkTime != null">
        CHECK_TIME,
      </if>
      <if test="checkUid != null">
        CHECK_UID,
      </if>
      <if test="checkUname != null">
        CHECK_UNAME,
      </if>
      <if test="checkStatus != null">
        CHECK_STATUS,
      </if>
      <if test="isDelete != null">
        IS_DELETE,
      </if>
      <if test="sendErp != null">
        SEND_ERP,
      </if>
      <if test="sendApp != null">
        SEND_APP,
      </if>
      <if test="sendCityId != null">
        SEND_CITY_ID,
      </if>
      <if test="deptIds != null">
        DEPT_IDS,
      </if>
      <if test="deptNames != null">
        DEPT_NAMES,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="spreadId != null">
        #{spreadId,jdbcType=INTEGER},
      </if>
      <if test="cityId != null">
        #{cityId,jdbcType=INTEGER},
      </if>
      <if test="devloperId != null">
        #{devloperId,jdbcType=INTEGER},
      </if>
      <if test="buildId != null">
        #{buildId,jdbcType=INTEGER},
      </if>
      <if test="regName != null">
        #{regName,jdbcType=VARCHAR},
      </if>
      <if test="deptNum != null">
        #{deptNum,jdbcType=INTEGER},
      </if>
      <if test="agentNum != null">
        #{agentNum,jdbcType=INTEGER},
      </if>
      <if test="dsConnectionId != null">
        #{dsConnectionId,jdbcType=VARCHAR},
      </if>
      <if test="spreadTitle != null">
        #{spreadTitle,jdbcType=VARCHAR},
      </if>
      <if test="spreadContent != null">
        #{spreadContent,jdbcType=VARCHAR},
      </if>
      <if test="creationTime != null">
        #{creationTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createUid != null">
        #{createUid,jdbcType=INTEGER},
      </if>
      <if test="checkTime != null">
        #{checkTime,jdbcType=TIMESTAMP},
      </if>
      <if test="checkUid != null">
        #{checkUid,jdbcType=INTEGER},
      </if>
      <if test="checkUname != null">
        #{checkUname,jdbcType=VARCHAR},
      </if>
      <if test="checkStatus != null">
        #{checkStatus,jdbcType=INTEGER},
      </if>
      <if test="isDelete != null">
        #{isDelete,jdbcType=INTEGER},
      </if>
      <if test="sendErp != null">
        #{sendErp,jdbcType=TINYINT},
      </if>
      <if test="sendApp != null">
        #{sendApp,jdbcType=TINYINT},
      </if>
      <if test="sendCityId != null">
        #{sendCityId,jdbcType=INTEGER},
      </if>
      <if test="deptIds != null">
        #{deptIds,jdbcType=CLOB},
      </if>
      <if test="deptNames != null">
        #{deptNames,jdbcType=CLOB},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.myfun.repository.agencydb.po.AgencySpread">
    <!--@mbggenerated-->
    update SPREAD
    <set>
      <if test="cityId != null">
        CITY_ID = #{cityId,jdbcType=INTEGER},
      </if>
      <if test="devloperId != null">
        DEVLOPER_ID = #{devloperId,jdbcType=INTEGER},
      </if>
      <if test="buildId != null">
        BUILD_ID = #{buildId,jdbcType=INTEGER},
      </if>
      <if test="regName != null">
        REG_NAME = #{regName,jdbcType=VARCHAR},
      </if>
      <if test="deptNum != null">
        DEPT_NUM = #{deptNum,jdbcType=INTEGER},
      </if>
      <if test="agentNum != null">
        AGENT_NUM = #{agentNum,jdbcType=INTEGER},
      </if>
      <if test="dsConnectionId != null">
        DS_CONNECTION_ID = #{dsConnectionId,jdbcType=VARCHAR},
      </if>
      <if test="spreadTitle != null">
        SPREAD_TITLE = #{spreadTitle,jdbcType=VARCHAR},
      </if>
      <if test="spreadContent != null">
        SPREAD_CONTENT = #{spreadContent,jdbcType=VARCHAR},
      </if>
      <if test="creationTime != null">
        CREATION_TIME = #{creationTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createUid != null">
        CREATE_UID = #{createUid,jdbcType=INTEGER},
      </if>
      <if test="checkTime != null">
        CHECK_TIME = #{checkTime,jdbcType=TIMESTAMP},
      </if>
      <if test="checkUid != null">
        CHECK_UID = #{checkUid,jdbcType=INTEGER},
      </if>
      <if test="checkUname != null">
        CHECK_UNAME = #{checkUname,jdbcType=VARCHAR},
      </if>
      <if test="checkStatus != null">
        CHECK_STATUS = #{checkStatus,jdbcType=INTEGER},
      </if>
      <if test="isDelete != null">
        IS_DELETE = #{isDelete,jdbcType=INTEGER},
      </if>
      <if test="sendErp != null">
        SEND_ERP = #{sendErp,jdbcType=TINYINT},
      </if>
      <if test="sendApp != null">
        SEND_APP = #{sendApp,jdbcType=TINYINT},
      </if>
      <if test="sendCityId != null">
        SEND_CITY_ID = #{sendCityId,jdbcType=INTEGER},
      </if>
      <if test="deptIds != null">
        DEPT_IDS = #{deptIds,jdbcType=CLOB},
      </if>
      <if test="deptNames != null">
        DEPT_NAMES = #{deptNames,jdbcType=CLOB},
      </if>
    </set>
    where SPREAD_ID = #{spreadId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.myfun.repository.agencydb.po.AgencySpread">
    <!--@mbggenerated-->
    update SPREAD
    set CITY_ID = #{cityId,jdbcType=INTEGER},
      DEVLOPER_ID = #{devloperId,jdbcType=INTEGER},
      BUILD_ID = #{buildId,jdbcType=INTEGER},
      REG_NAME = #{regName,jdbcType=VARCHAR},
      DEPT_NUM = #{deptNum,jdbcType=INTEGER},
      AGENT_NUM = #{agentNum,jdbcType=INTEGER},
      DS_CONNECTION_ID = #{dsConnectionId,jdbcType=VARCHAR},
      SPREAD_TITLE = #{spreadTitle,jdbcType=VARCHAR},
      SPREAD_CONTENT = #{spreadContent,jdbcType=VARCHAR},
      CREATION_TIME = #{creationTime,jdbcType=TIMESTAMP},
      CREATE_UID = #{createUid,jdbcType=INTEGER},
      CHECK_TIME = #{checkTime,jdbcType=TIMESTAMP},
      CHECK_UID = #{checkUid,jdbcType=INTEGER},
      CHECK_UNAME = #{checkUname,jdbcType=VARCHAR},
      CHECK_STATUS = #{checkStatus,jdbcType=INTEGER},
      IS_DELETE = #{isDelete,jdbcType=INTEGER},
      SEND_ERP = #{sendErp,jdbcType=TINYINT},
      SEND_APP = #{sendApp,jdbcType=TINYINT},
      SEND_CITY_ID = #{sendCityId,jdbcType=INTEGER},
      DEPT_IDS = #{deptIds,jdbcType=CLOB},
      DEPT_NAMES = #{deptNames,jdbcType=CLOB}
    where SPREAD_ID = #{spreadId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.myfun.repository.agencydb.po.AgencySpread">
    <!--@mbggenerated-->
    update SPREAD
    set CITY_ID = #{cityId,jdbcType=INTEGER},
      DEVLOPER_ID = #{devloperId,jdbcType=INTEGER},
      BUILD_ID = #{buildId,jdbcType=INTEGER},
      REG_NAME = #{regName,jdbcType=VARCHAR},
      DEPT_NUM = #{deptNum,jdbcType=INTEGER},
      AGENT_NUM = #{agentNum,jdbcType=INTEGER},
      DS_CONNECTION_ID = #{dsConnectionId,jdbcType=VARCHAR},
      SPREAD_TITLE = #{spreadTitle,jdbcType=VARCHAR},
      SPREAD_CONTENT = #{spreadContent,jdbcType=VARCHAR},
      CREATION_TIME = #{creationTime,jdbcType=TIMESTAMP},
      CREATE_UID = #{createUid,jdbcType=INTEGER},
      CHECK_TIME = #{checkTime,jdbcType=TIMESTAMP},
      CHECK_UID = #{checkUid,jdbcType=INTEGER},
      CHECK_UNAME = #{checkUname,jdbcType=VARCHAR},
      CHECK_STATUS = #{checkStatus,jdbcType=INTEGER},
      IS_DELETE = #{isDelete,jdbcType=INTEGER},
      SEND_ERP = #{sendErp,jdbcType=TINYINT},
      SEND_APP = #{sendApp,jdbcType=TINYINT},
      SEND_CITY_ID = #{sendCityId,jdbcType=INTEGER}
    where SPREAD_ID = #{spreadId,jdbcType=INTEGER}
  </update>
  
  <resultMap id="countBaseMap" type="com.myfun.repository.agencydb.dto.AgencySpreadDto">
	  <result column="SPREAD_COUNT" jdbcType="VARCHAR" property="spreadCount" />
	  <result column="SPREAD_COUNT_SUCC" jdbcType="VARCHAR" property="spreadCountSucc" />
	  <result column="DEPT_NUM" jdbcType="VARCHAR" property="deptNum" />
	  <result column="AGENT_NUM" jdbcType="VARCHAR" property="agentNum" />
  </resultMap>
  
  <!-- buniess -->
  <select id="getList" parameterType="com.myfun.repository.agencydb.param.AgencySpreadParam" resultMap="ResultMapWithBLOBs">
  	  select 
 	a.*
    from SPREAD a
    INNER JOIN BUILDING_INFO b ON a.CITY_ID = b.CITY_ID AND a.BUILD_ID = b.BUILD_ID
    where 1 = 1
   <if test="cityId != null and cityId != ''">
   		and a.CITY_ID = #{cityId}
   </if>
   <if test="buildName != null and buildName != ''">
   		and b.BUILD_NAME like '%${buildName}%'
   </if>
   <if test="checkStatuas != null and checkStatuas != ''">
   		and a.CHECK_STATUS = #{checkStatuas}
   </if>
   order by SPREAD_ID DESC
  </select>
  
  <select id="getCountSpread" resultMap="countBaseMap">
  <choose>
  	<when test="timeStart == null or timeStart == ''">
  		select 
		(select count(*) from SPREAD) SPREAD_COUNT,
		(select count(*) from SPREAD where CHECK_STATUS = 1) SPREAD_COUNT_SUCC,
		(select sum(DEPT_NUM) from SPREAD where SEND_ERP=1) DEPT_NUM,
		(select sum(AGENT_NUM) from SPREAD where SEND_APP=1) AGENT_NUM
  	</when>
  	<otherwise>
  		select 
			(select count(*) from SPREAD where CREATION_TIME&gt;#{timeStart} and CREATION_TIME <![CDATA[ < ]]> #{timeEnd}) SPREAD_COUNT,
			(select count(*) from SPREAD where CHECK_STATUS = 1 and CREATION_TIME&gt;#{timeStart} and CREATION_TIME <![CDATA[ < ]]> #{timeEnd}) SPREAD_COUNT_SUCC,
			(select sum(DEPT_NUM) from SPREAD where SEND_ERP=1 and CREATION_TIME&gt;#{timeStart} and CREATION_TIME<![CDATA[ < ]]> #{timeEnd}) DEPT_NUM,
			(select sum(AGENT_NUM) from SPREAD where SEND_APP=1 and CREATION_TIME&gt;#{timeStart} and CREATION_TIME<![CDATA[ < ]]> #{timeEnd}) AGENT_NUM
  	</otherwise>
  </choose>
  </select>
	
  <select id="getDistSystemMessage" parameterType="java.util.Map" resultMap="extResultMap">
  		select se.CREATION_TIME,sp.SPREAD_CONTENT,bi.BUILD_NAME,se.SPREAD_ID,se.IS_READ,sp.SPREAD_TITLE
  		from SPREAD_ERP se 
  		left join SPREAD sp on se.SPREAD_ID = sp.SPREAD_ID 
  		left join BUILDING_INFO bi on sp.build_id = bi.build_id
  		<where>
  			<if test=" null != archiveId">
  				and se.ARCHIVE_ID = #{archiveId} and sp.CHECK_STATUS = 1
  			</if>
  		</where>
  </select>	
	  
</mapper>